# Generic CRUD API Test Template
# Copy and customize for your REST API

name: crud-api-test
description: Generic Create-Read-Update-Delete API test flow
version: 1.0.0
tags:
  - api
  - crud
  - integration

allowed_environments:
  - dev
  - staging
  - qa

required_variables:
  - testTenant

default_variables:
  api_base_url: "${API_BASE_URL}"
  resource_name: "items"

steps:
  # CREATE
  - name: Create Resource
    type: api
    description: Create a new resource via POST
    api:
      method: POST
      url: "${api_base_url}/${resource_name}"
      headers:
        Content-Type: application/json
      body:
        name: "Test Item"
        description: "Created by QA Agent"
        testTenant: true
      expected_status: 201
      extract:
        resource_id: "$.id"

  # READ
  - name: Read Resource
    type: api
    description: Retrieve the created resource
    api:
      method: GET
      url: "${api_base_url}/${resource_name}/${resource_id}"
      expected_status: 200
      assertions:
        - type: exists
          target: "$.id"

  # UPDATE
  - name: Update Resource
    type: api
    description: Update the resource via PATCH
    api:
      method: PATCH
      url: "${api_base_url}/${resource_name}/${resource_id}"
      headers:
        Content-Type: application/json
      body:
        name: "Updated Test Item"
      expected_status: 200

  # DELETE
  - name: Delete Resource
    type: api
    description: Delete the resource
    api:
      method: DELETE
      url: "${api_base_url}/${resource_name}/${resource_id}"
      expected_status: 204

  # VERIFY DELETE
  - name: Verify Deletion
    type: api
    description: Confirm resource no longer exists
    api:
      method: GET
      url: "${api_base_url}/${resource_name}/${resource_id}"
      expected_status: 404
