# End-to-End User Journey Template
# Complete user workflow test

name: e2e-user-journey
description: End-to-end user journey combining UI and API tests
version: 1.0.0
tags:
  - e2e
  - user-journey
  - integration

allowed_environments:
  - dev
  - staging
  - qa

required_variables:
  - testTenant

default_variables:
  ui_base: "${UI_BASE_URL}"
  api_base: "${API_BASE_URL}"
  username: "test-user"
  password: "test-pass"

steps:
  # Step 1: API Health Check
  - name: Verify API Available
    type: api
    description: Ensure backend is healthy before starting
    api:
      method: GET
      url: "${api_base}/health"
      expected_status: 200
      retries: 3
      retry_delay_ms: 2000

  # Step 2: Login via UI
  - name: Open Login Page
    type: ui
    description: Navigate to login
    ui:
      action: navigate
      url: "${ui_base}/login"
      timeout_ms: 30000

  - name: Enter Username
    type: ui
    ui:
      action: fill
      selector: "#username, input[name='username']"
      value: "${username}"

  - name: Enter Password
    type: ui
    ui:
      action: fill
      selector: "#password, input[name='password']"
      value: "${password}"

  - name: Submit Login
    type: ui
    ui:
      action: click
      selector: "button[type='submit']"
      screenshot: true

  - name: Verify Dashboard
    type: ui
    ui:
      action: wait_for_selector
      selector: ".dashboard, #dashboard, .main-content"
      timeout_ms: 15000
      screenshot: true

  # Step 3: Create Item via UI
  - name: Click Create Button
    type: ui
    ui:
      action: click
      selector: ".create-btn, [data-testid='create'], button:has-text('Create')"
      screenshot: true

  - name: Fill Item Name
    type: ui
    ui:
      action: fill
      selector: "#item-name, input[name='name']"
      value: "Test Item from QA Agent"

  - name: Save Item
    type: ui
    ui:
      action: click
      selector: ".save-btn, [data-testid='save'], button:has-text('Save')"
      screenshot: true

  # Step 4: Logout
  - name: Logout
    type: ui
    ui:
      action: click
      selector: ".logout-btn, [data-testid='logout'], button:has-text('Logout')"
      screenshot: true
