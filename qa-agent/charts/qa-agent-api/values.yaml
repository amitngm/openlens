# QA Agent API - Helm Values
# Default configuration for qa-agent-api

replicaCount: 1

image:
  repository: amitngm/qa-agent
  tag: latest
  pullPolicy: Always

# Image pull secrets (if using private registry)
imagePullSecrets: []

nameOverride: ""
fullnameOverride: ""

# Service Account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# RBAC - Permissions for service discovery
rbac:
  create: true
  # Resources the QA Agent can access for discovery
  rules:
    - apiGroups: [""]
      resources: ["services", "pods", "configmaps", "secrets"]
      verbs: ["get", "list", "watch"]
    - apiGroups: [""]
      resources: ["pods/log"]
      verbs: ["get", "list"]
    - apiGroups: ["networking.k8s.io"]
      resources: ["ingresses"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["apps"]
      resources: ["deployments", "statefulsets", "daemonsets"]
      verbs: ["get", "list", "watch"]

# Service - ClusterIP only (no external access)
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

# Persistent Volume for artifacts (/data)
persistence:
  enabled: true
  storageClass: ""  # Use default storage class
  accessMode: ReadWriteOnce
  size: 5Gi
  # Existing PVC name (if you want to use existing)
  existingClaim: ""

# Network Policy - Allow only same-namespace access
networkPolicy:
  enabled: true
  # Additional ingress rules (e.g., from specific namespaces)
  additionalIngress: []
  # Example:
  # - from:
  #     - namespaceSelector:
  #         matchLabels:
  #           name: monitoring

# Pod configuration
podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  # readOnlyRootFilesystem: true  # Disabled for Playwright
  runAsNonRoot: true
  runAsUser: 1000

# Environment variables
env:
  # Data directory for artifacts
  - name: DATA_DIR
    value: "/data"
  # Block production by default
  - name: ALLOW_PROD
    value: "false"
  # Playwright browsers path
  - name: PLAYWRIGHT_BROWSERS_PATH
    value: "/app/browsers"

# Additional environment variables from secrets/configmaps
envFrom: []
# Example:
# - secretRef:
#     name: qa-agent-secrets

# Resource limits
resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

# Probes
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}

# Extra volumes and mounts (e.g., for custom login configs)
extraVolumes: []
extraVolumeMounts: []
